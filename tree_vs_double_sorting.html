<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Structure vs Double Sorting Comparison</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .method-toggle {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .toggle-btn {
            padding: 12px 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .toggle-btn.active {
            background: #667eea;
            color: white;
        }
        
        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .method-section {
            display: none;
        }
        
        .method-section.active {
            display: block;
        }
        
        .stock-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .stock-table th {
            background: #4a5568;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .stock-table td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .stock-table tr:hover {
            background: #f7fafc;
        }
        
        .highlight-row {
            background: #fff3cd !important;
            font-weight: bold;
            text-align: center !important;
            color: #856404;
        }
        
        /* Tree Structure Styles */
        .tree-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            overflow-x: auto;
        }
        
        .tree-level {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 20px;
        }
        
        .tree-node {
            background: white;
            border: 3px solid #667eea;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 10px 0;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .tree-node.size-split {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        .tree-node.value-split {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .tree-node.portfolio {
            background: #e7f3ff;
            border-color: #0066cc;
            font-weight: bold;
        }
        
        .node-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .node-value {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .node-details {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }
        
        .tree-line {
            width: 60px;
            height: 2px;
            background: #cbd5e0;
            position: relative;
        }
        
        .tree-lines {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Double Sorting Grid */
        .grid-container {
            display: grid;
            grid-template-columns: 100px repeat(3, 1fr);
            gap: 2px;
            background: #e2e8f0;
            padding: 2px;
            border-radius: 8px;
            margin: 30px 0;
        }
        
        .cell {
            background: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 120px;
        }
        
        .header-cell {
            background: #4a5568;
            color: white;
            font-size: 12px;
        }
        
        .row-label {
            background: #4a5568;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
        }
        
        .portfolio-cell {
            background: linear-gradient(135deg, #e7f3ff 0%, #cfe7ff 100%);
            border: 2px solid #0066cc;
            border-radius: 4px;
        }
        
        .portfolio-name {
            font-size: 18px;
            color: #0066cc;
            margin-bottom: 8px;
        }
        
        .stock-list {
            font-size: 11px;
            color: #2d3748;
            line-height: 1.6;
        }
        
        .comparison-box {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 30px 0;
            border-radius: 4px;
        }
        
        .comparison-box h3 {
            color: #2d3748;
            margin-top: 0;
        }
        
        .key-differences {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .diff-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .diff-card h4 {
            margin-top: 0;
            color: #667eea;
        }
        
        .diff-card ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .diff-card li {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        .pro {
            color: #28a745;
        }
        
        .con {
            color: #dc3545;
        }
        
        .flow-diagram {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .step-detail {
            color: #718096;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Portfolio Sorting Methods Comparison</h1>
        <div class="subtitle">Tree Structure Conditional Sorting vs Fama-French Double Sorting</div>
        
        <div class="method-toggle">
            <button class="toggle-btn active" onclick="showMethod('tree')">Tree Structure (Conditional)</button>
            <button class="toggle-btn" onclick="showMethod('double')">Double Sorting (Independent)</button>
            <button class="toggle-btn" onclick="showMethod('comparison')">Side-by-Side Comparison</button>
        </div>
        
        <!-- Tree Structure Method -->
        <div id="tree-method" class="method-section active">
            <h2>Tree Structure Conditional Sorting</h2>
            <p style="color: #718096; line-height: 1.8;">
                In tree structure sorting, we <strong>split sequentially</strong>: first by size, then within each size group, 
                we split by value using <strong>group-specific breakpoints</strong>. This creates a conditional hierarchy where 
                value classifications depend on which size group the stock belongs to.
            </p>
            
            <div class="flow-diagram">
                <h3 style="margin-top: 0;">Sorting Process Flow</h3>
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Size Split (First Level)</div>
                        <div class="step-detail">Split ALL stocks at median market cap ‚Üí Big group (5 stocks) and Small group (5 stocks)</div>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Value Split within BIG Group</div>
                        <div class="step-detail">Use 30th/70th percentiles of BIG stocks ONLY (B/M: 0.28, 0.85) ‚Üí B/L, B/M, B/H</div>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Value Split within SMALL Group</div>
                        <div class="step-detail">Use 30th/70th percentiles of SMALL stocks ONLY (B/M: 0.19, 0.75) ‚Üí S/L, S/M, S/H</div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <svg width="900" height="400" style="max-width: 100%;">
                    <!-- Root Node -->
                    <rect x="400" y="10" width="100" height="60" fill="#fff3cd" stroke="#ffc107" stroke-width="3" rx="8"/>
                    <text x="450" y="35" text-anchor="middle" font-size="14" font-weight="bold">All Stocks</text>
                    <text x="450" y="55" text-anchor="middle" font-size="11" fill="#666">(n=10)</text>
                    
                    <!-- Size Split Lines -->
                    <line x1="450" y1="70" x2="450" y2="100" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="200" y1="100" x2="700" y2="100" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="200" y1="100" x2="200" y2="130" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="700" y1="100" x2="700" y2="130" stroke="#cbd5e0" stroke-width="2"/>
                    
                    <!-- Big Group -->
                    <rect x="600" y="130" width="200" height="60" fill="#d4edda" stroke="#28a745" stroke-width="3" rx="8"/>
                    <text x="700" y="155" text-anchor="middle" font-size="14" font-weight="bold">Big (Cap ‚â• $46B)</text>
                    <text x="700" y="175" text-anchor="middle" font-size="11" fill="#666">AAPL, MSFT, JPM, CVX, F</text>
                    
                    <!-- Small Group -->
                    <rect x="100" y="130" width="200" height="60" fill="#d4edda" stroke="#28a745" stroke-width="3" rx="8"/>
                    <text x="200" y="155" text-anchor="middle" font-size="14" font-weight="bold">Small (Cap < $46B)</text>
                    <text x="200" y="175" text-anchor="middle" font-size="11" fill="#666">SHOP, ETSY, BLDR, FL, RBC</text>
                    
                    <!-- Big Group Value Split Lines -->
                    <line x1="700" y1="190" x2="700" y2="220" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="550" y1="220" x2="850" y2="220" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="550" y1="220" x2="550" y2="250" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="700" y1="220" x2="700" y2="250" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="850" y1="220" x2="850" y2="250" stroke="#cbd5e0" stroke-width="2"/>
                    
                    <!-- Big Portfolios -->
                    <rect x="500" y="250" width="100" height="70" fill="#e7f3ff" stroke="#0066cc" stroke-width="2" rx="6"/>
                    <text x="550" y="270" text-anchor="middle" font-size="16" font-weight="bold" fill="#0066cc">B/L</text>
                    <text x="550" y="288" text-anchor="middle" font-size="10">B/M < 0.28</text>
                    <text x="550" y="305" text-anchor="middle" font-size="9" fill="#666">MSFT</text>
                    
                    <rect x="650" y="250" width="100" height="70" fill="#e7f3ff" stroke="#0066cc" stroke-width="2" rx="6"/>
                    <text x="700" y="270" text-anchor="middle" font-size="16" font-weight="bold" fill="#0066cc">B/M</text>
                    <text x="700" y="288" text-anchor="middle" font-size="10">0.28-0.85</text>
                    <text x="700" y="305" text-anchor="middle" font-size="9" fill="#666">AAPL, JPM</text>
                    
                    <rect x="800" y="250" width="100" height="70" fill="#e7f3ff" stroke="#0066cc" stroke-width="2" rx="6"/>
                    <text x="850" y="270" text-anchor="middle" font-size="16" font-weight="bold" fill="#0066cc">B/H</text>
                    <text x="850" y="288" text-anchor="middle" font-size="10">B/M ‚â• 0.85</text>
                    <text x="850" y="305" text-anchor="middle" font-size="9" fill="#666">CVX, F</text>
                    
                    <!-- Small Group Value Split Lines -->
                    <line x1="200" y1="190" x2="200" y2="220" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="50" y1="220" x2="350" y2="220" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="50" y1="220" x2="50" y2="250" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="200" y1="220" x2="200" y2="250" stroke="#cbd5e0" stroke-width="2"/>
                    <line x1="350" y1="220" x2="350" y2="250" stroke="#cbd5e0" stroke-width="2"/>
                    
                    <!-- Small Portfolios -->
                    <rect x="0" y="250" width="100" height="70" fill="#e7f3ff" stroke="#0066cc" stroke-width="2" rx="6"/>
                    <text x="50" y="270" text-anchor="middle" font-size="16" font-weight="bold" fill="#0066cc">S/L</text>
                    <text x="50" y="288" text-anchor="middle" font-size="10">B/M < 0.19</text>
                    <text x="50" y="305" text-anchor="middle" font-size="9" fill="#666">ETSY</text>
                    
                    <rect x="150" y="250" width="100" height="70" fill="#e7f3ff" stroke="#0066cc" stroke-width="2" rx="6"/>
                    <text x="200" y="270" text-anchor="middle" font-size="16" font-weight="bold" fill="#0066cc">S/M</text>
                    <text x="200" y="288" text-anchor="middle" font-size="10">0.19-0.75</text>
                    <text x="200" y="305" text-anchor="middle" font-size="9" fill="#666">SHOP, BLDR</text>
                    
                    <rect x="300" y="250" width="100" height="70" fill="#e7f3ff" stroke="#0066cc" stroke-width="2" rx="6"/>
                    <text x="350" y="270" text-anchor="middle" font-size="16" font-weight="bold" fill="#0066cc">S/H</text>
                    <text x="350" y="288" text-anchor="middle" font-size="10">B/M ‚â• 0.75</text>
                    <text x="350" y="305" text-anchor="middle" font-size="9" fill="#666">FL, RBC</text>
                    
                    <!-- Labels -->
                    <text x="450" y="95" text-anchor="middle" font-size="12" fill="#666" font-weight="bold">Split at Median Cap = $46B</text>
                    <text x="700" y="215" text-anchor="middle" font-size="11" fill="#666">Big B/M 30%=0.28, 70%=0.85</text>
                    <text x="200" y="215" text-anchor="middle" font-size="11" fill="#666">Small B/M 30%=0.19, 70%=0.75</text>
                </svg>
            </div>
            
            <table class="stock-table">
                <thead>
                    <tr>
                        <th>Company</th>
                        <th>Ticker</th>
                        <th>Market Cap ($B)</th>
                        <th>B/M Ratio</th>
                        <th>Size Group</th>
                        <th>Value Group (Within Size)</th>
                        <th>Portfolio</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Apple</td>
                        <td>AAPL</td>
                        <td>2,800</td>
                        <td>0.15</td>
                        <td>Big</td>
                        <td>Medium (0.28-0.85)</td>
                        <td><strong>B/M</strong></td>
                    </tr>
                    <tr>
                        <td>Microsoft</td>
                        <td>MSFT</td>
                        <td>2,500</td>
                        <td>0.28</td>
                        <td>Big</td>
                        <td>Low (< 0.28)</td>
                        <td><strong>B/L</strong></td>
                    </tr>
                    <tr>
                        <td>JPMorgan</td>
                        <td>JPM</td>
                        <td>450</td>
                        <td>0.65</td>
                        <td>Big</td>
                        <td>Medium (0.28-0.85)</td>
                        <td><strong>B/M</strong></td>
                    </tr>
                    <tr>
                        <td>Chevron</td>
                        <td>CVX</td>
                        <td>280</td>
                        <td>0.85</td>
                        <td>Big</td>
                        <td>High (‚â• 0.85)</td>
                        <td><strong>B/H</strong></td>
                    </tr>
                    <tr>
                        <td>Ford</td>
                        <td>F</td>
                        <td>42</td>
                        <td>1.20</td>
                        <td>Big</td>
                        <td>High (‚â• 0.85)</td>
                        <td><strong>B/H</strong></td>
                    </tr>
                    <tr class="highlight-row">
                        <td colspan="7">‚Üê MEDIAN MARKET CAP = $46B (splits Big/Small) ‚Üí</td>
                    </tr>
                    <tr>
                        <td>Shopify</td>
                        <td>SHOP</td>
                        <td>38</td>
                        <td>0.22</td>
                        <td>Small</td>
                        <td>Medium (0.19-0.75)</td>
                        <td><strong>S/M</strong></td>
                    </tr>
                    <tr>
                        <td>Etsy</td>
                        <td>ETSY</td>
                        <td>12</td>
                        <td>0.18</td>
                        <td>Small</td>
                        <td>Low (< 0.19)</td>
                        <td><strong>S/L</strong></td>
                    </tr>
                    <tr>
                        <td>Builders FirstSource</td>
                        <td>BLDR</td>
                        <td>8</td>
                        <td>0.55</td>
                        <td>Small</td>
                        <td>Medium (0.19-0.75)</td>
                        <td><strong>S/M</strong></td>
                    </tr>
                    <tr>
                        <td>Foot Locker</td>
                        <td>FL</td>
                        <td>2</td>
                        <td>0.95</td>
                        <td>Small</td>
                        <td>High (‚â• 0.75)</td>
                        <td><strong>S/H</strong></td>
                    </tr>
                    <tr>
                        <td>Regional Bank Co</td>
                        <td>RBC</td>
                        <td>1.5</td>
                        <td>1.35</td>
                        <td>Small</td>
                        <td>High (‚â• 0.75)</td>
                        <td><strong>S/H</strong></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="comparison-box">
                <h3>Key Characteristics of Tree Structure</h3>
                <ul>
                    <li><strong>Conditional sorting:</strong> Value breakpoints differ between Big and Small groups</li>
                    <li><strong>Big stocks B/M breakpoints:</strong> 30th = 0.28, 70th = 0.85</li>
                    <li><strong>Small stocks B/M breakpoints:</strong> 30th = 0.19, 70th = 0.75</li>
                    <li><strong>Advantage:</strong> Each size group has balanced value distribution (roughly 33% in each value category)</li>
                    <li><strong>Disadvantage:</strong> Apple (B/M=0.15) is "Medium" in Big group but would be "Low" in Small group</li>
                </ul>
            </div>
        </div>
        
        <!-- Double Sorting Method -->
        <div id="double-method" class="method-section">
            <h2>Fama-French Double Sorting (Independent)</h2>
            <p style="color: #718096; line-height: 1.8;">
                In double sorting, we use <strong>independent breakpoints</strong>: size split uses median, but value breakpoints 
                use <strong>ALL stocks together</strong> (not group-specific). This ensures that "Value" and "Growth" definitions 
                are consistent across all stocks, regardless of size.
            </p>
            
            <div class="flow-diagram">
                <h3 style="margin-top: 0;">Sorting Process Flow</h3>
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Calculate Breakpoints Using ALL Stocks</div>
                        <div class="step-detail">Size: Median = $46B | Value: 30th percentile = 0.24, 70th percentile = 0.93 (using ALL 10 stocks)</div>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">First Sort: Classify by Size</div>
                        <div class="step-detail">Big if Cap ‚â• $46B, Small if Cap < $46B</div>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Second Sort: Classify by Value (Same Breakpoints for All)</div>
                        <div class="step-detail">Low if B/M < 0.24, Medium if 0.24 ‚â§ B/M < 0.93, High if B/M ‚â• 0.93</div>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-title">Assign to 2√ó3 Portfolio Grid</div>
                        <div class="step-detail">Intersection of Size √ó Value classifications ‚Üí 6 portfolios</div>
                    </div>
                </div>
            </div>
            
            <div class="grid-container">
                <div class="cell header-cell"></div>
                <div class="cell header-cell">Low (Growth)<br>B/M < 0.24</div>
                <div class="cell header-cell">Medium<br>0.24 ‚â§ B/M < 0.93</div>
                <div class="cell header-cell">High (Value)<br>B/M ‚â• 0.93</div>
                
                <div class="cell row-label">Big<br>(Cap ‚â• $46B)</div>
                <div class="cell portfolio-cell">
                    <div class="portfolio-name">B/L</div>
                    <div class="stock-list">
                        AAPL (0.15)<br>
                        MSFT (0.28)
                    </div>
                </div>
                <div class="cell portfolio-cell">
                    <div class="portfolio-name">B/M</div>
                    <div class="stock-list">
                        JPM (0.65)
                    </div>
                </div>
                <div class="cell portfolio-cell">
                    <div class="portfolio-name">B/H</div>
                    <div class="stock-list">
                        CVX (0.85)<br>
                        F (1.20)
                    </div>
                </div>
                
                <div class="cell row-label">Small<br>(Cap < $46B)</div>
                <div class="cell portfolio-cell">
                    <div class="portfolio-name">S/L</div>
                    <div class="stock-list">
                        SHOP (0.22)<br>
                        ETSY (0.18)
                    </div>
                </div>
                <div class="cell portfolio-cell">
                    <div class="portfolio-name">S/M</div>
                    <div class="stock-list">
                        BLDR (0.55)
                    </div>
                </div>
                <div class="cell portfolio-cell">
                    <div class="portfolio-name">S/H</div>
                    <div class="stock-list">
                        FL (0.95)<br>
                        RBC (1.35)
                    </div>
                </div>
            </div>
            
            <table class="stock-table">
                <thead>
                    <tr>
                        <th>Company</th>
                        <th>Ticker</th>
                        <th>Market Cap ($B)</th>
                        <th>B/M Ratio</th>
                        <th>Size Group</th>
                        <th>Value Group (Universal)</th>
                        <th>Portfolio</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Apple</td>
                        <td>AAPL</td>
                        <td>2,800</td>
                        <td>0.15</td>
                        <td>Big</td>
                        <td>Low (< 0.24)</td>
                        <td><strong>B/L</strong></td>
                    </tr>
                    <tr>
                        <td>Microsoft</td>
                        <td>MSFT</td>
                        <td>2,500</td>
                        <td>0.28</td>
                        <td>Big</td>
                        <td>Medium (0.24-0.93)</td>
                        <td><strong>B/M</strong></td>
                    </tr>
                    <tr>
                        <td>JPMorgan</td>
                        <td>JPM</td>
                        <td>450</td>
                        <td>0.65</td>
                        <td>Big</td>
                        <td>Medium (0.24-0.93)</td>
                        <td><strong>B/M</strong></td>
                    </tr>
                    <tr>
                        <td>Chevron</td>
                        <td>CVX</td>
                        <td>280</td>
                        <td>0.85</td>
                        <td>Big</td>
                        <td>Medium (0.24-0.93)</td>
                        <td><strong>B/M</strong></td>
                    </tr>
                    <tr>
                        <td>Ford</td>
                        <td>F</td>
                        <td>42</td>
                        <td>1.20</td>
                        <td>Big</td>
                        <td>High (‚â• 0.93)</td>
                        <td><strong>B/H</strong></td>
                    </tr>
                    <tr class="highlight-row">
                        <td colspan="7">‚Üê MEDIAN MARKET CAP = $46B | B/M 30th = 0.24, 70th = 0.93 (ALL stocks) ‚Üí</td>
                    </tr>
                    <tr>
                        <td>Shopify</td>
                        <td>SHOP</td>
                        <td>38</td>
                        <td>0.22</td>
                        <td>Small</td>
                        <td>Low (< 0.24)</td>
                        <td><strong>S/L</strong></td>
                    </tr>
                    <tr>
                        <td>Etsy</td>
                        <td>ETSY</td>
                        <td>12</td>
                        <td>0.18</td>
                        <td>Small</td>
                        <td>Low (< 0.24)</td>
                        <td><strong>S/L</strong></td>
                    </tr>
                    <tr>
                        <td>Builders FirstSource</td>
                        <td>BLDR</td>
                        <td>8</td>
                        <td>0.55</td>
                        <td>Small</td>
                        <td>Medium (0.24-0.93)</td>
                        <td><strong>S/M</strong></td>
                    </tr>
                    <tr>
                        <td>Foot Locker</td>
                        <td>FL</td>
                        <td>2</td>
                        <td>0.95</td>
                        <td>Small</td>
                        <td>High (‚â• 0.93)</td>
                        <td><strong>S/H</strong></td>
                    </tr>
                    <tr>
                        <td>Regional Bank Co</td>
                        <td>RBC</td>
                        <td>1.5</td>
                        <td>1.35</td>
                        <td>Small</td>
                        <td>High (‚â• 0.93)</td>
                        <td><strong>S/H</strong></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="comparison-box">
                <h3>Key Characteristics of Double Sorting</h3>
                <ul>
                    <li><strong>Independent sorting:</strong> Same value breakpoints for all stocks (0.24 and 0.93)</li>
                    <li><strong>Consistent definitions:</strong> "Value" and "Growth" mean the same thing regardless of size</li>
                    <li><strong>Advantage:</strong> Apple (B/M=0.15) and Etsy (B/M=0.18) are both "Growth" stocks consistently</li>
                    <li><strong>Advantage:</strong> Factors (SMB, HML) isolate pure size and value effects</li>
                    <li><strong>Note:</strong> Portfolio sizes may be unbalanced (e.g., B/M has 3 stocks, B/L has 2)</li>
                </ul>
            </div>
        </div>
        
        <!-- Comparison Section -->
        <div id="comparison-section" class="method-section">
            <h2>Side-by-Side Comparison</h2>
            
            <div style="overflow-x: auto;">
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th rowspan="2">Company</th>
                            <th rowspan="2">Market Cap</th>
                            <th rowspan="2">B/M Ratio</th>
                            <th colspan="2">Tree Structure (Conditional)</th>
                            <th colspan="2">Double Sort (Independent)</th>
                            <th rowspan="2">Match?</th>
                        </tr>
                        <tr>
                            <th>Value Group</th>
                            <th>Portfolio</th>
                            <th>Value Group</th>
                            <th>Portfolio</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Apple</strong></td>
                            <td>$2,800B</td>
                            <td>0.15</td>
                            <td>Medium (Big group)</td>
                            <td>B/M</td>
                            <td>Low (Growth)</td>
                            <td>B/L</td>
                            <td style="background: #ffebee; font-weight: bold;">‚ùå Different</td>
                        </tr>
                        <tr>
                            <td><strong>Microsoft</strong></td>
                            <td>$2,500B</td>
                            <td>0.28</td>
                            <td>Low (Big group)</td>
                            <td>B/L</td>
                            <td>Medium</td>
                            <td>B/M</td>
                            <td style="background: #ffebee; font-weight: bold;">‚ùå Different</td>
                        </tr>
                        <tr>
                            <td><strong>JPMorgan</strong></td>
                            <td>$450B</td>
                            <td>0.65</td>
                            <td>Medium (Big group)</td>
                            <td>B/M</td>
                            <td>Medium</td>
                            <td>B/M</td>
                            <td style="background: #e8f5e9; font-weight: bold;">‚úì Same</td>
                        </tr>
                        <tr>
                            <td><strong>Chevron</strong></td>
                            <td>$280B</td>
                            <td>0.85</td>
                            <td>High (Big group)</td>
                            <td>B/H</td>
                            <td>Medium</td>
                            <td>B/M</td>
                            <td style="background: #ffebee; font-weight: bold;">‚ùå Different</td>
                        </tr>
                        <tr>
                            <td><strong>Ford</strong></td>
                            <td>$42B</td>
                            <td>1.20</td>
                            <td>High (Big group)</td>
                            <td>B/H</td>
                            <td>High (Value)</td>
                            <td>B/H</td>
                            <td style="background: #e8f5e9; font-weight: bold;">‚úì Same</td>
                        </tr>
                        <tr>
                            <td><strong>Shopify</strong></td>
                            <td>$38B</td>
                            <td>0.22</td>
                            <td>Medium (Small group)</td>
                            <td>S/M</td>
                            <td>Low (Growth)</td>
                            <td>S/L</td>
                            <td style="background: #ffebee; font-weight: bold;">‚ùå Different</td>
                        </tr>
                        <tr>
                            <td><strong>Etsy</strong></td>
                            <td>$12B</td>
                            <td>0.18</td>
                            <td>Low (Small group)</td>
                            <td>S/L</td>
                            <td>Low (Growth)</td>
                            <td>S/L</td>
                            <td style="background: #e8f5e9; font-weight: bold;">‚úì Same</td>
                        </tr>
                        <tr>
                            <td><strong>Builders FirstSource</strong></td>
                            <td>$8B</td>
                            <td>0.55</td>
                            <td>Medium (Small group)</td>
                            <td>S/M</td>
                            <td>Medium</td>
                            <td>S/M</td>
                            <td style="background: #e8f5e9; font-weight: bold;">‚úì Same</td>
                        </tr>
                        <tr>
                            <td><strong>Foot Locker</strong></td>
                            <td>$2B</td>
                            <td>0.95</td>
                            <td>High (Small group)</td>
                            <td>S/H</td>
                            <td>High (Value)</td>
                            <td>S/H</td>
                            <td style="background: #e8f5e9; font-weight: bold;">‚úì Same</td>
                        </tr>
                        <tr>
                            <td><strong>Regional Bank</strong></td>
                            <td>$1.5B</td>
                            <td>1.35</td>
                            <td>High (Small group)</td>
                            <td>S/H</td>
                            <td>High (Value)</td>
                            <td>S/H</td>
                            <td style="background: #e8f5e9; font-weight: bold;">‚úì Same</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="comparison-box" style="margin-top: 30px;">
                <h3>Classification Agreement: 6 out of 10 stocks match (60%)</h3>
                <p>The methods disagree on 4 stocks: <strong>Apple, Microsoft, Chevron, and Shopify</strong></p>
            </div>
            
            <div class="key-differences">
                <div class="diff-card">
                    <h4>üå≥ Tree Structure (Conditional)</h4>
                    <ul>
                        <li class="pro">‚úì Balanced portfolios within each size group</li>
                        <li class="pro">‚úì Captures size-specific value patterns</li>
                        <li class="con">‚úó "Value" means different things for Big vs Small</li>
                        <li class="con">‚úó Apple is "Medium" but has very low B/M (0.15)</li>
                        <li class="con">‚úó Factors mix size and value effects</li>
                    </ul>
                    <p style="margin-top: 15px; font-size: 13px; color: #666;">
                        <strong>Best for:</strong> Research focusing on size-specific characteristics
                    </p>
                </div>
                
                <div class="diff-card">
                    <h4>üî¢ Double Sorting (Independent)</h4>
                    <ul>
                        <li class="pro">‚úì Consistent "Value/Growth" across all stocks</li>
                        <li class="pro">‚úì Pure factor isolation (SMB, HML)</li>
                        <li class="pro">‚úì Standard in academic research</li>
                        <li class="con">‚úó Unbalanced portfolios (some may be sparse)</li>
                        <li class="con">‚úó May miss size-specific patterns</li>
                    </ul>
                    <p style="margin-top: 15px; font-size: 13px; color: #666;">
                        <strong>Best for:</strong> Factor investing and risk-adjusted performance
                    </p>
                </div>
            </div>
            
            <div class="comparison-box" style="margin-top: 30px;">
                <h3>Why the Fama-French Method Uses Independent Sorting</h3>
                <ol style="line-height: 1.8;">
                    <li><strong>Factor interpretation:</strong> SMB isolates pure size effect, HML isolates pure value effect</li>
                    <li><strong>Economic meaning:</strong> A "value stock" should mean the same thing whether it's big or small</li>
                    <li><strong>Theoretical foundation:</strong> Risk factors should be independent and interpretable</li>
                    <li><strong>Empirical robustness:</strong> Consistent definitions lead to more stable factor premiums</li>
                    <li><strong>Practical application:</strong> Easier to explain to investors ("We buy high B/M stocks")</li>
                </ol>
            </div>
            
            <div class="comparison-box">
                <h3>When to Use Each Method</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div style="background: #f0f4ff; padding: 15px; border-radius: 6px;">
                        <strong>Use Tree Structure if:</strong>
                        <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                            <li>You need balanced portfolios</li>
                            <li>Studying size-specific patterns</li>
                            <li>Building quantile-based strategies</li>
                        </ul>
                    </div>
                    <div style="background: #fff4e6; padding: 15px; border-radius: 6px;">
                        <strong>Use Double Sorting if:</strong>
                        <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                            <li>Building factor models</li>
                            <li>Need consistent definitions</li>
                            <li>Following academic standards</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function showMethod(method) {
            // Hide all sections
            document.getElementById('tree-method').classList.remove('active');
            document.getElementById('double-method').classList.remove('active');
            document.getElementById('comparison-section').classList.remove('active');
            
            // Remove active from all buttons
            const buttons = document.querySelectorAll('.toggle-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected section and activate button
            if (method === 'tree') {
                document.getElementById('tree-method').classList.add('active');
                buttons[0].classList.add('active');
            } else if (method === 'double') {
                document.getElementById('double-method').classList.add('active');
                buttons[1].classList.add('active');
            } else {
                document.getElementById('comparison-section').classList.add('active');
                buttons[2].classList.add('active');
            }
        }
    </script>
</body>
</html>